local player = game.Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local hrp = char:WaitForChild("HumanoidRootPart")
local tweenService = game:GetService("TweenService")

local escapePoint = CFrame.new(21.29, 137.60, 466.10)

-- Prompt’tan kasanın gerçek Part’ını bul
local function getPromptPart(prompt)
	local parent = prompt.Parent
	while parent and not parent:IsA("BasePart") do
		parent = parent.Parent
	end
	return parent
end

-- Tween ile hareket
local function tweenTo(target)
	if not target then return end
	local tweenInfo = TweenInfo.new(3, Enum.EasingStyle.Linear)
	local goal = {CFrame = target.CFrame + Vector3.new(0, 0, 0)}
	local tween = tweenService:Create(hrp, tweenInfo, goal)
	tween:Play()
	tween.Completed:Wait()
end

-- En yakın kasanın promptunu bulma
local function getNearestPrompt()
	local nearestPrompt, nearestDist
	local kasalar = workspace:FindFirstChild("Kasalar")
	if not kasalar then return nil end

	for _, obj in ipairs(kasalar:GetDescendants()) do
		if obj:IsA("ProximityPrompt") then
			local kasaPart = getPromptPart(obj)
			if kasaPart then
				local innerPart = kasaPart.Parent:FindFirstChild("Part")
				if innerPart and innerPart:IsA("BasePart") and innerPart.Color == Color3.fromRGB(255,0,0) then
					continue -- kırmızıysa atla
				end
				local dist = (hrp.Position - kasaPart.Position).Magnitude
				if not nearestDist or dist < nearestDist then
					nearestDist = dist
					nearestPrompt = obj
				end
			end
		end
	end
	return nearestPrompt
end

-- EscapePoint tween fonksiyonu
local function tweenToEscape()
	if (hrp.Position - escapePoint.Position).Magnitude > 30 then
		local tweenInfo = TweenInfo.new(3, Enum.EasingStyle.Linear)
		local goal = {CFrame = escapePoint}
		local tween = tweenService:Create(hrp, tweenInfo, goal)
		tween:Play()
		tween.Completed:Wait()
	end
end

-- Ana loop
spawn(function()
	while task.wait(20) do
		tweenToEscape()
	end
end)

while task.wait(1) do
	-- Önce paraları topla

	-- Sonra kasalara git
	local prompt = getNearestPrompt()
	if prompt then
		local kasaPart = getPromptPart(prompt)
		if kasaPart then
			tweenTo(kasaPart)
			task.wait(0.5)
			fireproximityprompt(prompt)
			task.wait(1.5)
		end
	end
task.wait(3)
end
