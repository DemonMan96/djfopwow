-- Autofarm Kasa Scripti (eski mantık + kırmızı filtre + EscapePoint)
local player = game.Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local hrp = char:WaitForChild("HumanoidRootPart")
local tweenService = game:GetService("TweenService")

local escapePoint = CFrame.new(21.29, 137.60, 466.10)

-- Prompt’tan kasanın gerçek Part’ını bul
local function getPromptPart(prompt)
    local parent = prompt.Parent
    while parent and not parent:IsA("BasePart") do
        parent = parent.Parent
    end
    return parent
end

-- Tween ile hareket
local function tweenTo(pos)
    local dist = (hrp.Position - pos).Magnitude
    local time = math.clamp(dist / 25, 3, 8) -- mesafeye göre hız
    local tween = tweenService:Create(hrp, TweenInfo.new(time, Enum.EasingStyle.Linear), {CFrame = CFrame.new(pos)})
    tween:Play()
    tween.Completed:Wait()
end

-- EscapePoint tween fonksiyonu
local function tweenToEscape()
    if (hrp.Position - escapePoint.Position).Magnitude > 30 then
        local tweenInfo = TweenInfo.new(3, Enum.EasingStyle.Linear)
        local goal = {CFrame = escapePoint}
        local tween = tweenService:Create(hrp, tweenInfo, goal)
        tween:Play()
        tween.Completed:Wait()
    end
end

-- En yakın kasanın promptunu bul (kırmızı olanları atla)
local function getNearestPrompt()
    local nearestPrompt, nearestDist
    local kasalar = workspace:FindFirstChild("Kasalar")
    if not kasalar then return nil end

    for _, obj in ipairs(kasalar:GetDescendants()) do
        if obj:IsA("ProximityPrompt") then
            local kasaPart = getPromptPart(obj)
            if kasaPart then
                local kasaModel = kasaPart.Parent
                local innerPart = kasaModel:FindFirstChild("Part")
                if innerPart and innerPart:IsA("BasePart") and innerPart.Color == Color3.fromRGB(255,0,0) then
                    continue
                end
                local dist = (hrp.Position - kasaPart.Position).Magnitude
                if not nearestDist or dist < nearestDist then
                    nearestDist = dist
                    nearestPrompt = obj
                end
            end
        end
    end
    return nearestPrompt
end

-- Cash toplama
local function collectCash()
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("MeshPart") and (obj.Name == "Cash1" or obj.Name == "Cash2" or obj.Name == "Cash3") then
            local clickDetector = obj:FindFirstChildWhichIsA("ClickDetector")
            if clickDetector then
                local dist = (hrp.Position - obj.Position).Magnitude
                if dist <= 18 then
                    fireclickdetector(clickDetector)
                end
            end
        end
    end
end

-- Seat'leri temizle
for i, v in pairs(workspace:GetDescendants()) do
    if v:IsA("Seat") then
        v:Destroy()
    end
end

-- EscapePoint tween loop'u
spawn(function()
    while task.wait(43.2) do
        tweenToEscape()
    end
end)

-- Ana loop: kasalar
spawn(function()
    while task.wait(1) do
        local prompt = getNearestPrompt()
        if prompt then
            local kasaPart = getPromptPart(prompt)
            if kasaPart then
                tweenTo(kasaPart.Position) -- kasanın üstüne git
                task.wait(0.5)
                fireproximityprompt(prompt) -- UI’ye bakmadan tetikle
                task.wait(3) -- cash spawn için bekle
            end
        end
    end
end)

