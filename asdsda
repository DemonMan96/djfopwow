-- Autofarm Kasa Scripti
local player = game.Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local hrp = char:WaitForChild("HumanoidRootPart")
local tweenService = game:GetService("TweenService")

-- Tween ile hareket
local function tweenTo(pos)
    local tween = tweenService:Create(hrp, TweenInfo.new(2, Enum.EasingStyle.Linear), {CFrame = CFrame.new(pos)})
    tween:Play()
    tween.Completed:Wait()
end

-- En yakın enabled kasa (ProximityPrompt) bulma
local function getNearestPrompt()
    local nearestPrompt, nearestDist
    local kasalar = workspace:FindFirstChild("Kasalar")
    if not kasalar then return nil end

    for _, obj in ipairs(kasalar:GetDescendants()) do
        if obj:IsA("ProximityPrompt") and obj.Enabled then
            local kasaPart = obj.Parent
            if kasaPart and kasaPart:IsA("BasePart") then
                local dist = (hrp.Position - kasaPart.Position).Magnitude
                if not nearestDist or dist < nearestDist then
                    nearestDist = dist
                    nearestPrompt = obj
                end
            elseif kasaPart and kasaPart:IsA("Model") and kasaPart.PrimaryPart then
                -- Eğer kasa Model ise PrimaryPart üzerinden pozisyon al
                local dist = (hrp.Position - kasaPart.PrimaryPart.Position).Magnitude
                if not nearestDist or dist < nearestDist then
                    nearestDist = dist
                    nearestPrompt = obj
                end
            end
        end
    end
    return nearestPrompt
end

-- Cash toplama
local function collectCash()
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("MeshPart") and (obj.Name == "Cash1" or obj.Name == "Cash2" or obj.Name == "Cash3") then
            local clickDetector = obj:FindFirstChildWhichIsA("ClickDetector")
            if clickDetector then
                local dist = (hrp.Position - obj.Position).Magnitude
                if dist <= 18 then
                    fireclickdetector(clickDetector)
                end
            end
        end
    end
end

-- Ana loop
while task.wait(1) do
    local prompt = getNearestPrompt()
    if prompt then
        local kasaPart = prompt.Parent
        local targetPos

        if kasaPart:IsA("BasePart") then
            targetPos = kasaPart.Position
        elseif kasaPart:IsA("Model") and kasaPart.PrimaryPart then
            targetPos = kasaPart.PrimaryPart.Position
        end

        if targetPos then
            tweenTo(targetPos + Vector3.new(0, 5, 0)) -- biraz yukarıdan git
            task.wait(0.5)
            fireproximityprompt(prompt)
            task.wait(2) -- cash spawn için bekle
            collectCash()
        end
    end
end
