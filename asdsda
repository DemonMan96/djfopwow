-- Autofarm Kasa + Para Toplama Scripti
local player = game.Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local hrp = char:WaitForChild("HumanoidRootPart")
local tweenService = game:GetService("TweenService")

-- Prompt’tan kasanın gerçek Part’ını bul
local function getPromptPart(prompt)
    local parent = prompt.Parent
    while parent and not parent:IsA("BasePart") do
        parent = parent.Parent
    end
    return parent
end

-- Tween ile hareket
local function tweenTo(pos)
    local dist = (hrp.Position - pos).Magnitude
    local time = math.clamp(dist / 25, 0.5, 5) -- mesafeye göre hız
    local tween = tweenService:Create(hrp, TweenInfo.new(time, Enum.EasingStyle.Linear), {CFrame = CFrame.new(pos)})
    tween:Play()
    tween.Completed:Wait()
end

-- En yakın kasanın promptunu bul (kırmızı olanları atla)
local function getNearestPrompt()
    local nearestPrompt, nearestDist
    local kasalar = workspace:FindFirstChild("Kasalar")
    if not kasalar then return nil end

    for _, obj in ipairs(kasalar:GetDescendants()) do
        if obj:IsA("ProximityPrompt") then
            local kasaPart = getPromptPart(obj)
            if kasaPart then
                -- Kasanın içindeki "Part" kontrolü
                local kasaModel = kasaPart.Parent
                local innerPart = kasaModel:FindFirstChild("Part")

                -- Eğer Part kırmızıysa kasayı atla
                if innerPart and innerPart:IsA("BasePart") and innerPart.Color == Color3.fromRGB(255,0,0) then
                    continue
                end

                local dist = (hrp.Position - kasaPart.Position).Magnitude
                if not nearestDist or dist < nearestDist then
                    nearestDist = dist
                    nearestPrompt = obj
                end
            end
        end
    end
    return nearestPrompt
end

-- Para toplama (ClickDetector fixli)
local function collectCash()
    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("ClickDetector") 
            and v.Parent 
            and (v.Parent.Name:find("Cash1") or v.Parent.Name:find("Cash2") or v.Parent.Name:find("Cash3")) then
            
            local dist = (hrp.Position - v.Parent.Position).Magnitude
            if dist <= 18 then
                while v.Parent and v.Parent:IsDescendantOf(workspace) do
                    fireclickdetector(v)
                    task.wait()
                end
            end
        end
    end
end

-- Gereksiz seatleri sil
for _, v in pairs(workspace:GetDescendants()) do
	if v:IsA("Seat") then
		v:Destroy()
	end
end

-- Ana loop: kasalara git
task.spawn(function()
    while task.wait(1) do
        local prompt = getNearestPrompt()
        if prompt then
            local kasaPart = getPromptPart(prompt)
            if kasaPart then
                tweenTo(kasaPart.Position) -- kasanın üstüne git
                task.wait(0.5)
                fireproximityprompt(prompt) -- kasa aç
                task.wait(6) -- cash spawn bekle
            end
        end
    end
end)

-- Para toplama loop
task.spawn(function()
    while task.wait() do
        collectCash()
    end
end)
